<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TriStage Chat • Non‑MCP</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <header>
      <div class="wrap row">
        <div class="nav">
          <div class="brand">TriStage RAG</div>
          <a href="/chat" class="pill">Chat</a>
          <a href="/search" class="pill" onclick="event.preventDefault();document.getElementById('searchPane').scrollIntoView({behavior:'smooth'})">Search</a>
          <a href="/embed" class="pill">Embed</a>
        </div>
        <div class="nav">
          <span class="pill">Device: {{ stats.config.device }}</span>
          <span class="pill">Docs: {{ stats.document_stats.total_documents }}</span>
          <span class="pill">Searches: {{ stats.search_count }}</span>
        </div>
      </div>
    </header>
    <main class="wrap grid">
      <section class="panel">
        <form action="/chat/send" method="post" class="grid">
          <label for="message">Ask a question</label>
          <textarea name="message" id="message" placeholder="Message TriStage… (Ctrl/Cmd+Enter to send)" required onkeydown="return onKeyDown(event)"></textarea>
          <div class="row">
            <div class="flex">
              <label for="top_k" class="muted">Top‑k</label>
              <select name="top_k" id="top_k">
                {% for k in [3,5,10,20] %}
                <option value="{{k}}" {% if k==5 %}selected{% endif %}>{{k}}</option>
                {% endfor %}
              </select>
            </div>
            <div class="right">
              <button class="btn" type="submit">Send</button>
            </div>
          </div>
        </form>
      </section>
      <section class="panel">
        <div class="mb8 muted">Conversation</div>
        <div class="list">
          {% for m in history %}
          <div class="item">
            <div class="muted">{{ m.role.title() }}</div>
            <div>{{ m.content|safe }}</div>
          </div>
          {% endfor %}
        </div>
      </section>
      <section id="searchPane"></section>
      <div class="footer">Tip: Use Ctrl/Cmd+Enter to send. Stage‑3 score is shown in the answer footer.</div>
    </main>
    <script>
      function onKeyDown(e){
        if(e.key==='Enter' && (e.ctrlKey||e.metaKey)){
          e.target.form.submit();
          return false;
        }
        return true;
      }
    </script>
  </body>
  </html>

