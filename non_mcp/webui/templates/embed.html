<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Embed â€¢ TriStage RAG</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <header>
      <div class="wrap row">
        <div class="nav">
          <div class="brand">TriStage RAG</div>
          <a href="/chat" class="pill">Chat</a>
          <a href="/search" class="pill">Search</a>
          <a href="/embed" class="pill">Embed</a>
        </div>
        {% if stats %}
        <div class="nav">
          <span class="pill">Device: {{ stats.config.device }}</span>
          <span class="pill">Docs: {{ stats.document_stats.total_documents }}</span>
          <span class="pill">Searches: {{ stats.search_count }}</span>
        </div>
        {% endif %}
      </div>
    </header>
    <main class="wrap grid">
      <section class="panel">
        <h3 class="mb8">Embed uploads</h3>
        <form action="/embed" method="post" enctype="multipart/form-data" class="grid">
          <input type="hidden" name="action" value="upload">
          <div class="grid two">
            <div>
              <label>Files (txt/md/json/pdf/docx)</label>
              <input type="file" name="file" multiple>
            </div>
            <div>
              <label>Chunking</label>
              <div class="row">
                <input type="number" name="chunk_size" value="1000" min="100" class="w100">
                <input type="number" name="overlap" value="200" min="0" class="w100">
              </div>
            </div>
          </div>
          <div class="right"><button class="btn" type="submit">Embed uploads</button></div>
        </form>
      </section>

      <section class="panel">
        <h3 class="mb8">Embed from documents/</h3>
        <form action="/embed" method="post" class="grid">
          <input type="hidden" name="action" value="repo_all">
          <div class="row">
            <div class="flex">
              <label class="muted">Chunking</label>
              <input type="number" name="chunk_size" value="1000" min="100">
              <input type="number" name="overlap" value="200" min="0">
            </div>
            <div class="right"><button class="btn" type="submit">Embed all</button></div>
          </div>
        </form>
        <div class="mt8 muted">Status under documents/</div>
        <div class="list mt8">
          {% for s in statuses %}
          <div class="item">
            <div class="row">
              <div>{{ s.path }}</div>
              <div class="chip">{{ s.size_bytes }} bytes</div>
              <div class="chip">{{ 'embedded' if s.embedded else 'not embedded' }}</div>
            </div>
          </div>
          {% endfor %}
        </div>
      </section>

      <section class="panel">
        <h3 class="mb8">Maintenance</h3>
        <form action="/api/clear" method="post" onsubmit="return confirm('Clear documents and index?');">
          <button class="btn danger" type="submit">Clear all data</button>
        </form>
      </section>
    </main>
  </body>
  </html>

